[DEBUG][ENV] SUPABASE_URL: https://kbmsygyawpiqegemzetp.supabase.co
[DEBUG][ENV] SUPABASE_SERVICE_ROLE_KEY: SET
[DEMO] Facebook demo handler not available
üöÄ Server running on port 3001
üìä Health check: http://localhost:3001/api/health
üåê Environment: development
[Invite Verify] Looking for token: 39bb8b18ec5579dd60af88f012b7b08377b3f0e6b704b58f6287005bd1cb8914
[Invite Verify] Token length: 64
[Invite Verify] Looking for token: 39bb8b18ec5579dd60af88f012b7b08377b3f0e6b704b58f6287005bd1cb8914
[Invite Verify] Token length: 64
[Invite Verify] User exists check: { email: 'marwie.ang.0904@gmail.com', exists: true }
[Invite Verify] SUCCESS - Valid invitation: {
  email: 'marwie.ang.0904@gmail.com',
  organizationName: 'leadify',
  userExists: true,
  token: '39bb8b18ec...'
}
[Invite Verify] User exists check: { email: 'marwie.ang.0904@gmail.com', exists: true }
[Invite Verify] SUCCESS - Valid invitation: {
  email: 'marwie.ang.0904@gmail.com',
  organizationName: 'leadify',
  userExists: true,
  token: '39bb8b18ec...'
}
[Organization Invite] Email sent successfully to zarealmarwie@gmail.com. Email ID: undefined
[Organization Invite] Successfully created invitation for zarealmarwie@gmail.com to join leadify
[Organization Members] Returning 1 members for organization 770257fa-dc41-4529-9cb3-43b47072c271
[Organization Members] Sending organizationId: 770257fa-dc41-4529-9cb3-43b47072c271
[Invite Verify] Looking for token: fc3425010a72e508edadfdcf3cf74bd3c9e8c76f6a87ba13fa1454f5d4191514
[Invite Verify] Token length: 64
[Invite Verify] Looking for token: fc3425010a72e508edadfdcf3cf74bd3c9e8c76f6a87ba13fa1454f5d4191514
[Invite Verify] Token length: 64
[Invite Verify] User exists check: { email: 'zarealmarwie@gmail.com', exists: false }
[Invite Verify] SUCCESS - Valid invitation: {
  email: 'zarealmarwie@gmail.com',
  organizationName: 'leadify',
  userExists: false,
  token: 'fc3425010a...'
}
[Invite Verify] User exists check: { email: 'zarealmarwie@gmail.com', exists: false }
[Invite Verify] SUCCESS - Valid invitation: {
  email: 'zarealmarwie@gmail.com',
  organizationName: 'leadify',
  userExists: false,
  token: 'fc3425010a...'
}
[Invite Verify] Looking for token: fc3425010a72e508edadfdcf3cf74bd3c9e8c76f6a87ba13fa1454f5d4191514
[Invite Verify] Token length: 64
[Invite Verify] Looking for token: fc3425010a72e508edadfdcf3cf74bd3c9e8c76f6a87ba13fa1454f5d4191514
[Invite Verify] Token length: 64
[Invite Verify] User exists check: { email: 'zarealmarwie@gmail.com', exists: false }
[Invite Verify] SUCCESS - Valid invitation: {
  email: 'zarealmarwie@gmail.com',
  organizationName: 'leadify',
  userExists: false,
  token: 'fc3425010a...'
}
[Invite Verify] User exists check: { email: 'zarealmarwie@gmail.com', exists: false }
[Invite Verify] SUCCESS - Valid invitation: {
  email: 'zarealmarwie@gmail.com',
  organizationName: 'leadify',
  userExists: false,
  token: 'fc3425010a...'
}
[INVITE ACCEPT] Starting invite acceptance...
[INVITE ACCEPT] Request body: {
  token: 'fc3425010a72e508edadfdcf3cf74bd3c9e8c76f6a87ba13fa1454f5d4191514',
  password: '[HIDDEN]',
  confirmPassword: 'ayokonga123',
  firstName: 'Zar Zie',
  lastName: 'Zang',
  existingUser: false
}
[INVITE ACCEPT] Verifying invitation token...
[INVITE ACCEPT] Valid invitation found: {
  email: 'zarealmarwie@gmail.com',
  organizationId: '770257fa-dc41-4529-9cb3-43b47072c271',
  organizationName: 'leadify'
}
[INVITE ACCEPT] Creating new user account with auto-confirmation...
[INVITE ACCEPT] New user created successfully with auto-confirmation: {
  userId: 'a8a9a81e-74b6-4206-b6a8-ce2d321c3ac9',
  email: 'zarealmarwie@gmail.com',
  emailConfirmed: true
}
[INVITE ACCEPT] User authenticated, proceeding to add to organization...
[INVITE ACCEPT] User ID: a8a9a81e-74b6-4206-b6a8-ce2d321c3ac9
[INVITE ACCEPT] Has Session: true
[INVITE ACCEPT] Adding user to organization...
[INVITE ACCEPT] User successfully added to organization: {
  id: 'e8320bd1-5a4f-4c84-8688-70d2fed6c896',
  organization_id: '770257fa-dc41-4529-9cb3-43b47072c271',
  user_id: 'a8a9a81e-74b6-4206-b6a8-ce2d321c3ac9',
  role: 'member',
  invited_at: '2025-08-09T05:57:06.602414+00:00',
  joined_at: '2025-08-09T05:57:06.511+00:00'
}
[INVITE ACCEPT] Invitation process completed successfully
[Organization Members] Returning 2 members for organization 770257fa-dc41-4529-9cb3-43b47072c271
[Organization Members] Sending organizationId: 770257fa-dc41-4529-9cb3-43b47072c271
[Organization Members] Returning 2 members for organization 770257fa-dc41-4529-9cb3-43b47072c271
[Organization Members] Sending organizationId: 770257fa-dc41-4529-9cb3-43b47072c271
[Role Update] Successfully updated role for user: a8a9a81e-74b6-4206-b6a8-ce2d321c3ac9 to: agent
[Organization Members] Returning 2 members for organization 770257fa-dc41-4529-9cb3-43b47072c271
[Organization Members] Sending organizationId: 770257fa-dc41-4529-9cb3-43b47072c271
[Organization Members] Returning 2 members for organization 770257fa-dc41-4529-9cb3-43b47072c271
[Organization Members] Sending organizationId: 770257fa-dc41-4529-9cb3-43b47072c271
[Agents] User 4c984a9a-150e-4673-8192-17f80a7ef4d7 belongs to organizations: [ '770257fa-dc41-4529-9cb3-43b47072c271' ]
[Agents] User 4c984a9a-150e-4673-8192-17f80a7ef4d7 belongs to organizations: [ '770257fa-dc41-4529-9cb3-43b47072c271' ]
[Agents] Found 1 agents using organization_id
[Agents] Returning 1 agents for user 4c984a9a-150e-4673-8192-17f80a7ef4d7
[Agents] Found 1 agents using organization_id
[Agents] Returning 1 agents for user 4c984a9a-150e-4673-8192-17f80a7ef4d7
[FB Status] Checking status for agent: ec41d39f-7009-4a84-b00e-095745e17158
[FB Status] Found 0 page mappings
[Agents] User 4c984a9a-150e-4673-8192-17f80a7ef4d7 belongs to organizations: [ '770257fa-dc41-4529-9cb3-43b47072c271' ]
[Agents] User 4c984a9a-150e-4673-8192-17f80a7ef4d7 belongs to organizations: [ '770257fa-dc41-4529-9cb3-43b47072c271' ]
[Agents] Found 1 agents using organization_id
[Agents] Returning 1 agents for user 4c984a9a-150e-4673-8192-17f80a7ef4d7
[Agents] Found 1 agents using organization_id
[Agents] Returning 1 agents for user 4c984a9a-150e-4673-8192-17f80a7ef4d7
[FB Status] Checking status for agent: ec41d39f-7009-4a84-b00e-095745e17158
[FB Status] Found 0 page mappings

======================================================================
üì® NEW CHAT REQUEST RECEIVED
======================================================================
[CHAT] üïí Timestamp: 2025-08-09T05:57:33.473Z
[CHAT] üìß Message: "hello..."
[CHAT] ü§ñ Agent ID: ec41d39f-7009-4a84-b00e-095745e17158
[CHAT] üåê Source: web
[CHAT] üë§ User ID: preview-user
[CHAT] üí¨ Conversation ID: New conversation
======================================================================
[TIMING] Conversation fetch/create: 782ms
[CHAT] Conversation ID: cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
[DEBUG] Starting parallel operations for conversation cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
[DEBUG] About to save message and fetch agent data...
[DEBUG] Agent config fetched: found
[DEBUG] Agent fetched: found
[DEBUG] Messages fetched: 0 messages
[DEBUG] Message saved for cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
[TIMING] Parallel DB operations (save msg + fetch agent/config/messages): 727ms

[MASTER INTENT] ============================================================
[MASTER INTENT] üß† CONTEXT-AWARE INTENT CLASSIFICATION
[MASTER INTENT] ============================================================
[MASTER INTENT] üìù User Message: "hello..."
[MASTER INTENT] üìä Context Window: 1 messages
[MASTER INTENT] ü§ñ Model: gpt-4.1-nano-2025-04-14 + Pattern Recognition
[TIMING] AI Intent Classification: 2307ms
[MASTER INTENT] ü§ñ AI Response: "GREETING"
[MASTER INTENT] ‚úÖ FINAL CLASSIFICATION: GREETING
[MASTER INTENT] ‚è±Ô∏è Response Time: 2307ms
[MASTER INTENT] ============================================================

[TIMING] Intent Classification: 2310ms 
[CHAT] Intent Classification: GREETING
[GREETING] Handling greeting message instantly
[GREETING] Response generated in 0ms (no API call)

======================================================================
üéâ CHAT REQUEST COMPLETED
======================================================================
[CHAT] üéØ Final Intent: GREETING
[CHAT] üí¨ Conversation ID: cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
[CHAT] ü§ñ AI Response: "Hi there! I'd be happy to assist you with your real estate needs. Are you looking to buy or rent?..."
[CHAT] ‚è±Ô∏è Total Processing Time: 3820ms
[CHAT] ‚úÖ Response sent to client
======================================================================

[ASYNC] AI message saved
[Conversation Messages] Retrieved 2 messages for conversation cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6

======================================================================
üì® NEW CHAT REQUEST RECEIVED
======================================================================
[CHAT] üïí Timestamp: 2025-08-09T05:58:28.645Z
[CHAT] üìß Message: "what properties do you have in katipunan?..."
[CHAT] ü§ñ Agent ID: ec41d39f-7009-4a84-b00e-095745e17158
[CHAT] üåê Source: web
[CHAT] üë§ User ID: preview-user
[CHAT] üí¨ Conversation ID: cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
======================================================================
[TIMING] Conversation fetch/create: 270ms
[CHAT] Conversation ID: cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
[DEBUG] Starting parallel operations for conversation cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
[DEBUG] About to save message and fetch agent data...
[DEBUG] Agent fetched: found
[DEBUG] Agent config fetched: found
[DEBUG] Messages fetched: 2 messages
[DEBUG] Message saved for cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
[TIMING] Parallel DB operations (save msg + fetch agent/config/messages): 841ms

[MASTER INTENT] ============================================================
[MASTER INTENT] üß† CONTEXT-AWARE INTENT CLASSIFICATION
[MASTER INTENT] ============================================================
[MASTER INTENT] üìù User Message: "what properties do you have in katipunan?..."
[MASTER INTENT] üìä Context Window: 3 messages
[MASTER INTENT] ü§ñ Model: gpt-4.1-nano-2025-04-14 + Pattern Recognition
[MASTER INTENT] üéØ Context: AI just asked about NEED
[MASTER INTENT] üîç Pattern Detection: BANT answer detected!
[MASTER INTENT]   Type: contact
[MASTER INTENT]   Confidence: 90%
[MASTER INTENT] ‚úÖ HIGH CONFIDENCE PATTERN MATCH: BANT
[MASTER INTENT] üöÄ Skipping AI classification (pattern confidence: 90%)
[MASTER INTENT] ============================================================

[TIMING] Intent Classification: 2ms 
[CHAT] Intent Classification: BANT

[BANT] ============================================================
[BANT] üéØ PROCESSING BANT WORKFLOW
[BANT] ============================================================
[BANT] üí¨ Conversation ID: cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
[BANT] üë§ User: preview-user
[BANT] üìß Message: "what properties do you have in katipunan?..."
[BANT] Using system_prompt from agent_configs (intent=BANT)
[BANT] Prompt length: 88 characters
[BANT EXTRACTION] Starting synchronous BANT extraction...
[BANT EXTRACTION] Starting with 3 existing messages
[BANT EXTRACTION] Last 3 messages before adding current:
  [0] user: "hello..."
  [1] ai: "Hi there! I'd be happy to assist you with your rea..."
  [2] user: "what properties do you have in katipunan?..."
[BANT EXTRACTION] Current message already included, total: 3 messages
[BANT EXTRACTION] Final messages for extraction:
  [-1] user: "hello..."
  [0] ai: "Hi there! I'd be happy to assist you with your rea..."
  [1] user: "what properties do you have in katipunan?..."

[EXTRACT BANT] ===== STARTING AI BANT EXTRACTION =====
[EXTRACT BANT] Analyzing last 3 messages
[EXTRACT BANT] ü§ñ Using AI extraction ONLY (no pattern detection)
[EXTRACT BANT] ü§ñ AI Extraction Results:
[EXTRACT BANT]   Budget: ‚ùå Not found
[EXTRACT BANT]   Authority: ‚ùå Not found
[EXTRACT BANT]   Need: ‚ùå Not found
[EXTRACT BANT]   Timeline: ‚ùå Not found
[EXTRACT BANT] ‚úÖ Final Results (AI Only):
[EXTRACT BANT]   Budget: ‚ùå Not found
[EXTRACT BANT]   Authority: ‚ùå Not found
[EXTRACT BANT]   Need: ‚ùå Not found
[EXTRACT BANT]   Timeline: ‚ùå Not found
[EXTRACT BANT] ===== EXTRACTION COMPLETE =====

[BANT EXTRACTION] Extraction took 1833ms
[BANT PROMPT] Current BANT state after synchronous extraction:
  Budget: ‚ùå NOT FOUND
  Authority: ‚ùå NOT FOUND
  Need: ‚ùå NOT FOUND
  Timeline: ‚ùå NOT FOUND
[BANT] Using FIXED QUESTIONS LOGIC for guaranteed accuracy

[EXTRACT BANT] ===== STARTING AI BANT EXTRACTION =====
[EXTRACT BANT] Analyzing last 2 messages
[EXTRACT BANT] ü§ñ Using AI extraction ONLY (no pattern detection)
[EXTRACT BANT] ü§ñ AI Extraction Results:
[EXTRACT BANT]   Budget: ‚ùå Not found
[EXTRACT BANT]   Authority: ‚ùå Not found
[EXTRACT BANT]   Need: ‚ùå Not found
[EXTRACT BANT]   Timeline: ‚ùå Not found
[EXTRACT BANT] ‚úÖ Final Results (AI Only):
[EXTRACT BANT]   Budget: ‚ùå Not found
[EXTRACT BANT]   Authority: ‚ùå Not found
[EXTRACT BANT]   Need: ‚ùå Not found
[EXTRACT BANT]   Timeline: ‚ùå Not found
[EXTRACT BANT] ===== EXTRACTION COMPLETE =====

[BANT] Previous BANT state: { budget: null, authority: null, need: null, timeline: null }
[BANT] Fixed response generated:
  Acknowledgment: ""
  Next Question: "To help find the perfect property for you, what's your budget range?"
  Full Response: "To help find the perfect property for you, what's your budget range?"

======================================================================
üéâ CHAT REQUEST COMPLETED
======================================================================
[CHAT] üéØ Final Intent: BANT
[CHAT] üí¨ Conversation ID: cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
[CHAT] ü§ñ AI Response: "To help find the perfect property for you, what's your budget range?..."
[CHAT] ‚è±Ô∏è Total Processing Time: 4608ms
[CHAT] ‚úÖ Response sent to client
======================================================================

[ASYNC] AI message saved

======================================================================
üì® NEW CHAT REQUEST RECEIVED
======================================================================
[CHAT] üïí Timestamp: 2025-08-09T05:58:37.038Z
[CHAT] üìß Message: "50M..."
[CHAT] ü§ñ Agent ID: ec41d39f-7009-4a84-b00e-095745e17158
[CHAT] üåê Source: web
[CHAT] üë§ User ID: preview-user
[CHAT] üí¨ Conversation ID: cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
======================================================================
[TIMING] Conversation fetch/create: 263ms
[CHAT] Conversation ID: cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
[DEBUG] Starting parallel operations for conversation cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
[DEBUG] About to save message and fetch agent data...
[DEBUG] Agent config fetched: found
[DEBUG] Agent fetched: found
[DEBUG] Messages fetched: 4 messages
[DEBUG] Message saved for cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
[TIMING] Parallel DB operations (save msg + fetch agent/config/messages): 729ms

[MASTER INTENT] ============================================================
[MASTER INTENT] üß† CONTEXT-AWARE INTENT CLASSIFICATION
[MASTER INTENT] ============================================================
[MASTER INTENT] üìù User Message: "50M..."
[MASTER INTENT] üìä Context Window: 5 messages
[MASTER INTENT] ü§ñ Model: gpt-4.1-nano-2025-04-14 + Pattern Recognition
[MASTER INTENT] üéØ Context: AI just asked about BUDGET
[MASTER INTENT] üîç Pattern Detection: BANT answer detected!
[MASTER INTENT]   Type: budget
[MASTER INTENT]   Confidence: 90%
[MASTER INTENT] ‚úÖ HIGH CONFIDENCE PATTERN MATCH: BANT
[MASTER INTENT] üöÄ Skipping AI classification (pattern confidence: 90%)
[MASTER INTENT] ============================================================

[TIMING] Intent Classification: 0ms 
[CHAT] Intent Classification: BANT

[BANT] ============================================================
[BANT] üéØ PROCESSING BANT WORKFLOW
[BANT] ============================================================
[BANT] üí¨ Conversation ID: cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
[BANT] üë§ User: preview-user
[BANT] üìß Message: "50M..."
[BANT] Using system_prompt from agent_configs (intent=BANT)
[BANT] Prompt length: 88 characters
[BANT EXTRACTION] Starting synchronous BANT extraction...
[BANT EXTRACTION] Starting with 5 existing messages
[BANT EXTRACTION] Last 3 messages before adding current:
  [0] user: "what properties do you have in katipunan?..."
  [1] ai: "To help find the perfect property for you, what's ..."
  [2] user: "50M..."
[BANT EXTRACTION] Current message already included, total: 5 messages
[BANT EXTRACTION] Final messages for extraction:
  [1] ai: "Hi there! I'd be happy to assist you with your rea..."
  [2] user: "what properties do you have in katipunan?..."
  [3] ai: "To help find the perfect property for you, what's ..."
  [4] user: "50M..."

[EXTRACT BANT] ===== STARTING AI BANT EXTRACTION =====
[EXTRACT BANT] Analyzing last 5 messages
[EXTRACT BANT] ü§ñ Using AI extraction ONLY (no pattern detection)
[EXTRACT BANT] ü§ñ AI Extraction Results:
[EXTRACT BANT]   Budget: 50M
[EXTRACT BANT]   Authority: ‚ùå Not found
[EXTRACT BANT]   Need: ‚ùå Not found
[EXTRACT BANT]   Timeline: ‚ùå Not found
[EXTRACT BANT] ‚úÖ Final Results (AI Only):
[EXTRACT BANT]   Budget: 50M
[EXTRACT BANT]   Authority: ‚ùå Not found
[EXTRACT BANT]   Need: ‚ùå Not found
[EXTRACT BANT]   Timeline: ‚ùå Not found
[EXTRACT BANT] ===== EXTRACTION COMPLETE =====

[BANT EXTRACTION] Extraction took 1660ms
[BANT PROMPT] Current BANT state after synchronous extraction:
  Budget: 50M
  Authority: ‚ùå NOT FOUND
  Need: ‚ùå NOT FOUND
  Timeline: ‚ùå NOT FOUND
[BANT] Using FIXED QUESTIONS LOGIC for guaranteed accuracy

[EXTRACT BANT] ===== STARTING AI BANT EXTRACTION =====
[EXTRACT BANT] Analyzing last 4 messages
[EXTRACT BANT] ü§ñ Using AI extraction ONLY (no pattern detection)
[EXTRACT BANT] ü§ñ AI Extraction Results:
[EXTRACT BANT]   Budget: ‚ùå Not found
[EXTRACT BANT]   Authority: ‚ùå Not found
[EXTRACT BANT]   Need: ‚ùå Not found
[EXTRACT BANT]   Timeline: ‚ùå Not found
[EXTRACT BANT] ‚úÖ Final Results (AI Only):
[EXTRACT BANT]   Budget: ‚ùå Not found
[EXTRACT BANT]   Authority: ‚ùå Not found
[EXTRACT BANT]   Need: ‚ùå Not found
[EXTRACT BANT]   Timeline: ‚ùå Not found
[EXTRACT BANT] ===== EXTRACTION COMPLETE =====

[BANT] Previous BANT state: { budget: null, authority: null, need: null, timeline: null }
[BANT] Fixed response generated:
  Acknowledgment: "Great! I've noted your budget of 50M. "
  Next Question: "Will you be the sole decision maker for this purchase?"
  Full Response: "Great! I've noted your budget of 50M. Will you be the sole decision maker for this purchase?"

======================================================================
üéâ CHAT REQUEST COMPLETED
======================================================================
[CHAT] üéØ Final Intent: BANT
[CHAT] üí¨ Conversation ID: cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
[CHAT] ü§ñ AI Response: "Great! I've noted your budget of 50M. Will you be the sole decision maker for this purchase?..."
[CHAT] ‚è±Ô∏è Total Processing Time: 3340ms
[CHAT] ‚úÖ Response sent to client
======================================================================

[ASYNC] AI message saved

======================================================================
üì® NEW CHAT REQUEST RECEIVED
======================================================================
[CHAT] üïí Timestamp: 2025-08-09T05:58:46.111Z
[CHAT] üìß Message: "yes..."
[CHAT] ü§ñ Agent ID: ec41d39f-7009-4a84-b00e-095745e17158
[CHAT] üåê Source: web
[CHAT] üë§ User ID: preview-user
[CHAT] üí¨ Conversation ID: cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
======================================================================
[TIMING] Conversation fetch/create: 256ms
[CHAT] Conversation ID: cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
[DEBUG] Starting parallel operations for conversation cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
[DEBUG] About to save message and fetch agent data...
[DEBUG] Messages fetched: 6 messages
[DEBUG] Agent fetched: found
[DEBUG] Agent config fetched: found
[DEBUG] Message saved for cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
[TIMING] Parallel DB operations (save msg + fetch agent/config/messages): 715ms

[MASTER INTENT] ============================================================
[MASTER INTENT] üß† CONTEXT-AWARE INTENT CLASSIFICATION
[MASTER INTENT] ============================================================
[MASTER INTENT] üìù User Message: "yes..."
[MASTER INTENT] üìä Context Window: 5 messages
[MASTER INTENT] ü§ñ Model: gpt-4.1-nano-2025-04-14 + Pattern Recognition
[MASTER INTENT] üéØ Context: AI just asked about BUDGET
[MASTER INTENT] üîç Pattern Detection: BANT answer detected!
[MASTER INTENT]   Type: authority
[MASTER INTENT]   Confidence: 95%
[MASTER INTENT] ‚úÖ HIGH CONFIDENCE PATTERN MATCH: BANT
[MASTER INTENT] üöÄ Skipping AI classification (pattern confidence: 95%)
[MASTER INTENT] ============================================================

[TIMING] Intent Classification: 0ms 
[CHAT] Intent Classification: BANT

[BANT] ============================================================
[BANT] üéØ PROCESSING BANT WORKFLOW
[BANT] ============================================================
[BANT] üí¨ Conversation ID: cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
[BANT] üë§ User: preview-user
[BANT] üìß Message: "yes..."
[BANT] Using system_prompt from agent_configs (intent=BANT)
[BANT] Prompt length: 88 characters
[BANT EXTRACTION] Starting synchronous BANT extraction...
[BANT EXTRACTION] Starting with 7 existing messages
[BANT EXTRACTION] Last 3 messages before adding current:
  [0] user: "50M..."
  [1] ai: "Great! I've noted your budget of 50M. Will you be ..."
  [2] user: "yes..."
[BANT EXTRACTION] Current message already included, total: 7 messages
[BANT EXTRACTION] Final messages for extraction:
  [3] ai: "To help find the perfect property for you, what's ..."
  [4] user: "50M..."
  [5] ai: "Great! I've noted your budget of 50M. Will you be ..."
  [6] user: "yes..."

[EXTRACT BANT] ===== STARTING AI BANT EXTRACTION =====
[EXTRACT BANT] Analyzing last 7 messages
[EXTRACT BANT] ü§ñ Using AI extraction ONLY (no pattern detection)
[EXTRACT BANT] ü§ñ AI Extraction Results:
[EXTRACT BANT]   Budget: 50M
[EXTRACT BANT]   Authority: yes
[EXTRACT BANT]   Need: ‚ùå Not found
[EXTRACT BANT]   Timeline: ‚ùå Not found
[EXTRACT BANT] ‚úÖ Final Results (AI Only):
[EXTRACT BANT]   Budget: 50M
[EXTRACT BANT]   Authority: yes
[EXTRACT BANT]   Need: ‚ùå Not found
[EXTRACT BANT]   Timeline: ‚ùå Not found
[EXTRACT BANT] ===== EXTRACTION COMPLETE =====

[BANT EXTRACTION] Extraction took 2200ms
[BANT PROMPT] Current BANT state after synchronous extraction:
  Budget: 50M
  Authority: yes
  Need: ‚ùå NOT FOUND
  Timeline: ‚ùå NOT FOUND
[BANT] Using FIXED QUESTIONS LOGIC for guaranteed accuracy

[EXTRACT BANT] ===== STARTING AI BANT EXTRACTION =====
[EXTRACT BANT] Analyzing last 6 messages
[EXTRACT BANT] ü§ñ Using AI extraction ONLY (no pattern detection)
[EXTRACT BANT] ü§ñ AI Extraction Results:
[EXTRACT BANT]   Budget: 50M
[EXTRACT BANT]   Authority: ‚ùå Not found
[EXTRACT BANT]   Need: ‚ùå Not found
[EXTRACT BANT]   Timeline: ‚ùå Not found
[EXTRACT BANT] ‚úÖ Final Results (AI Only):
[EXTRACT BANT]   Budget: 50M
[EXTRACT BANT]   Authority: ‚ùå Not found
[EXTRACT BANT]   Need: ‚ùå Not found
[EXTRACT BANT]   Timeline: ‚ùå Not found
[EXTRACT BANT] ===== EXTRACTION COMPLETE =====

[BANT] Previous BANT state: { budget: '50M', authority: null, need: null, timeline: null }
[BANT] Fixed response generated:
  Acknowledgment: "Perfect, thank you for confirming. "
  Next Question: "Will this property be for personal residence or investment?"
  Full Response: "Perfect, thank you for confirming. Will this property be for personal residence or investment?"

======================================================================
üéâ CHAT REQUEST COMPLETED
======================================================================
[CHAT] üéØ Final Intent: BANT
[CHAT] üí¨ Conversation ID: cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
[CHAT] ü§ñ AI Response: "Perfect, thank you for confirming. Will this property be for personal residence or investment?..."
[CHAT] ‚è±Ô∏è Total Processing Time: 4535ms
[CHAT] ‚úÖ Response sent to client
======================================================================

[ASYNC] AI message saved

======================================================================
üì® NEW CHAT REQUEST RECEIVED
======================================================================
[CHAT] üïí Timestamp: 2025-08-09T05:59:53.936Z
[CHAT] üìß Message: "personal residence ..."
[CHAT] ü§ñ Agent ID: ec41d39f-7009-4a84-b00e-095745e17158
[CHAT] üåê Source: web
[CHAT] üë§ User ID: preview-user
[CHAT] üí¨ Conversation ID: cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
======================================================================
[TIMING] Conversation fetch/create: 762ms
[CHAT] Conversation ID: cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
[DEBUG] Starting parallel operations for conversation cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
[DEBUG] About to save message and fetch agent data...
[DEBUG] Agent config fetched: found
[DEBUG] Agent fetched: found
[DEBUG] Messages fetched: 8 messages
[DEBUG] Message saved for cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
[TIMING] Parallel DB operations (save msg + fetch agent/config/messages): 752ms

[MASTER INTENT] ============================================================
[MASTER INTENT] üß† CONTEXT-AWARE INTENT CLASSIFICATION
[MASTER INTENT] ============================================================
[MASTER INTENT] üìù User Message: "personal residence ..."
[MASTER INTENT] üìä Context Window: 5 messages
[MASTER INTENT] ü§ñ Model: gpt-4.1-nano-2025-04-14 + Pattern Recognition
[MASTER INTENT] üéØ Context: AI just asked about BUDGET
[MASTER INTENT] üîç Pattern Detection: BANT answer detected!
[MASTER INTENT]   Type: need
[MASTER INTENT]   Confidence: 90%
[MASTER INTENT] ‚úÖ HIGH CONFIDENCE PATTERN MATCH: BANT
[MASTER INTENT] üöÄ Skipping AI classification (pattern confidence: 90%)
[MASTER INTENT] ============================================================

[TIMING] Intent Classification: 0ms 
[CHAT] Intent Classification: BANT

[BANT] ============================================================
[BANT] üéØ PROCESSING BANT WORKFLOW
[BANT] ============================================================
[BANT] üí¨ Conversation ID: cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
[BANT] üë§ User: preview-user
[BANT] üìß Message: "personal residence ..."
[BANT] Using system_prompt from agent_configs (intent=BANT)
[BANT] Prompt length: 88 characters
[BANT EXTRACTION] Starting synchronous BANT extraction...
[BANT EXTRACTION] Starting with 9 existing messages
[BANT EXTRACTION] Last 3 messages before adding current:
  [0] user: "yes..."
  [1] ai: "Perfect, thank you for confirming. Will this prope..."
  [2] user: "personal residence ..."
[BANT EXTRACTION] Current message already included, total: 9 messages
[BANT EXTRACTION] Final messages for extraction:
  [5] ai: "Great! I've noted your budget of 50M. Will you be ..."
  [6] user: "yes..."
  [7] ai: "Perfect, thank you for confirming. Will this prope..."
  [8] user: "personal residence ..."

[EXTRACT BANT] ===== STARTING AI BANT EXTRACTION =====
[EXTRACT BANT] Analyzing last 9 messages
[EXTRACT BANT] ü§ñ Using AI extraction ONLY (no pattern detection)
[EXTRACT BANT] ü§ñ AI Extraction Results:
[EXTRACT BANT]   Budget: 50M
[EXTRACT BANT]   Authority: yes
[EXTRACT BANT]   Need: personal residence
[EXTRACT BANT]   Timeline: ‚ùå Not found
[EXTRACT BANT] ‚úÖ Final Results (AI Only):
[EXTRACT BANT]   Budget: 50M
[EXTRACT BANT]   Authority: yes
[EXTRACT BANT]   Need: personal residence
[EXTRACT BANT]   Timeline: ‚ùå Not found
[EXTRACT BANT] ===== EXTRACTION COMPLETE =====

[BANT EXTRACTION] Extraction took 2094ms
[BANT PROMPT] Current BANT state after synchronous extraction:
  Budget: 50M
  Authority: yes
  Need: personal residence
  Timeline: ‚ùå NOT FOUND
[BANT] Using FIXED QUESTIONS LOGIC for guaranteed accuracy

[EXTRACT BANT] ===== STARTING AI BANT EXTRACTION =====
[EXTRACT BANT] Analyzing last 8 messages
[EXTRACT BANT] ü§ñ Using AI extraction ONLY (no pattern detection)
[EXTRACT BANT] ü§ñ AI Extraction Results:
[EXTRACT BANT]   Budget: 50M
[EXTRACT BANT]   Authority: yes
[EXTRACT BANT]   Need: ‚ùå Not found
[EXTRACT BANT]   Timeline: ‚ùå Not found
[EXTRACT BANT] ‚úÖ Final Results (AI Only):
[EXTRACT BANT]   Budget: 50M
[EXTRACT BANT]   Authority: yes
[EXTRACT BANT]   Need: ‚ùå Not found
[EXTRACT BANT]   Timeline: ‚ùå Not found
[EXTRACT BANT] ===== EXTRACTION COMPLETE =====

[BANT] Previous BANT state: { budget: '50M', authority: 'yes', need: null, timeline: null }
[BANT] Fixed response generated:
  Acknowledgment: "Great, for your personal residence! "
  Next Question: "When are you planning to make this purchase?"
  Full Response: "Great, for your personal residence! When are you planning to make this purchase?"

======================================================================
üéâ CHAT REQUEST COMPLETED
======================================================================
[CHAT] üéØ Final Intent: BANT
[CHAT] üí¨ Conversation ID: cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
[CHAT] ü§ñ AI Response: "Great, for your personal residence! When are you planning to make this purchase?..."
[CHAT] ‚è±Ô∏è Total Processing Time: 5162ms
[CHAT] ‚úÖ Response sent to client
======================================================================

[ASYNC] AI message saved

======================================================================
üì® NEW CHAT REQUEST RECEIVED
======================================================================
[CHAT] üïí Timestamp: 2025-08-09T06:00:04.164Z
[CHAT] üìß Message: "next month..."
[CHAT] ü§ñ Agent ID: ec41d39f-7009-4a84-b00e-095745e17158
[CHAT] üåê Source: web
[CHAT] üë§ User ID: preview-user
[CHAT] üí¨ Conversation ID: cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
======================================================================
[TIMING] Conversation fetch/create: 252ms
[CHAT] Conversation ID: cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
[DEBUG] Starting parallel operations for conversation cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
[DEBUG] About to save message and fetch agent data...
[DEBUG] Agent config fetched: found
[DEBUG] Agent fetched: found
[DEBUG] Messages fetched: 10 messages
[DEBUG] Message saved for cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
[TIMING] Parallel DB operations (save msg + fetch agent/config/messages): 742ms

[MASTER INTENT] ============================================================
[MASTER INTENT] üß† CONTEXT-AWARE INTENT CLASSIFICATION
[MASTER INTENT] ============================================================
[MASTER INTENT] üìù User Message: "next month..."
[MASTER INTENT] üìä Context Window: 5 messages
[MASTER INTENT] ü§ñ Model: gpt-4.1-nano-2025-04-14 + Pattern Recognition
[MASTER INTENT] üéØ Context: AI just asked about NEED
[MASTER INTENT] üîç Pattern Detection: BANT answer detected!
[MASTER INTENT]   Type: timeline
[MASTER INTENT]   Confidence: 85%
[MASTER INTENT] ‚úÖ HIGH CONFIDENCE PATTERN MATCH: BANT
[MASTER INTENT] üöÄ Skipping AI classification (pattern confidence: 85%)
[MASTER INTENT] ============================================================

[TIMING] Intent Classification: 1ms 
[CHAT] Intent Classification: BANT

[BANT] ============================================================
[BANT] üéØ PROCESSING BANT WORKFLOW
[BANT] ============================================================
[BANT] üí¨ Conversation ID: cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
[BANT] üë§ User: preview-user
[BANT] üìß Message: "next month..."
[BANT] Using system_prompt from agent_configs (intent=BANT)
[BANT] Prompt length: 88 characters
[BANT EXTRACTION] Starting synchronous BANT extraction...
[BANT EXTRACTION] Starting with 11 existing messages
[BANT EXTRACTION] Last 3 messages before adding current:
  [0] user: "personal residence ..."
  [1] ai: "Great, for your personal residence! When are you p..."
  [2] user: "next month..."
[BANT EXTRACTION] Current message already included, total: 11 messages
[BANT EXTRACTION] Final messages for extraction:
  [7] ai: "Perfect, thank you for confirming. Will this prope..."
  [8] user: "personal residence ..."
  [9] ai: "Great, for your personal residence! When are you p..."
  [10] user: "next month..."

[EXTRACT BANT] ===== STARTING AI BANT EXTRACTION =====
[EXTRACT BANT] Analyzing last 11 messages
[EXTRACT BANT] ü§ñ Using AI extraction ONLY (no pattern detection)
[EXTRACT BANT] ü§ñ AI Extraction Results:
[EXTRACT BANT]   Budget: 50M
[EXTRACT BANT]   Authority: yes
[EXTRACT BANT]   Need: personal residence
[EXTRACT BANT]   Timeline: next month
[EXTRACT BANT] ‚úÖ Final Results (AI Only):
[EXTRACT BANT]   Budget: 50M
[EXTRACT BANT]   Authority: yes
[EXTRACT BANT]   Need: personal residence
[EXTRACT BANT]   Timeline: next month
[EXTRACT BANT] ===== EXTRACTION COMPLETE =====

[BANT EXTRACTION] Extraction took 1558ms
[BANT PROMPT] Current BANT state after synchronous extraction:
  Budget: 50M
  Authority: yes
  Need: personal residence
  Timeline: next month
[BANT EXTRACTION] BANT fields complete, extracting contact info...
[EXTRACT CONTACT] Result: { fullName: null, mobileNumber: null, email: null }
[BANT EXTRACTION] Contact info extracted: { fullName: null, mobileNumber: null, email: null }
[BANT] Using FIXED QUESTIONS LOGIC for guaranteed accuracy

[EXTRACT BANT] ===== STARTING AI BANT EXTRACTION =====
[EXTRACT BANT] Analyzing last 10 messages
[EXTRACT BANT] ü§ñ Using AI extraction ONLY (no pattern detection)
[EXTRACT BANT] ü§ñ AI Extraction Results:
[EXTRACT BANT]   Budget: 50M
[EXTRACT BANT]   Authority: yes
[EXTRACT BANT]   Need: personal residence
[EXTRACT BANT]   Timeline: ‚ùå Not found
[EXTRACT BANT] ‚úÖ Final Results (AI Only):
[EXTRACT BANT]   Budget: 50M
[EXTRACT BANT]   Authority: yes
[EXTRACT BANT]   Need: personal residence
[EXTRACT BANT]   Timeline: ‚ùå Not found
[EXTRACT BANT] ===== EXTRACTION COMPLETE =====

[BANT] Previous BANT state: {
  budget: '50M',
  authority: 'yes',
  need: 'personal residence',
  timeline: null
}
[BANT] Fixed response generated:
  Acknowledgment: "Perfect, next month works! "
  Next Question: "Excellent! To send you the best property options, may I have your name and contact number?"
  Full Response: "Perfect, next month works! Excellent! To send you the best property options, may I have your name and contact number?"

======================================================================
üéâ CHAT REQUEST COMPLETED
======================================================================
[CHAT] üéØ Final Intent: BANT
[CHAT] üí¨ Conversation ID: cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
[CHAT] ü§ñ AI Response: "Perfect, next month works! Excellent! To send you the best property options, may I have your name and contact number?..."
[CHAT] ‚è±Ô∏è Total Processing Time: 5008ms
[CHAT] ‚úÖ Response sent to client
======================================================================

[ASYNC] AI message saved

======================================================================
üì® NEW CHAT REQUEST RECEIVED
======================================================================
[CHAT] üïí Timestamp: 2025-08-09T06:00:21.888Z
[CHAT] üìß Message: "Philippe Count, 09248123121..."
[CHAT] ü§ñ Agent ID: ec41d39f-7009-4a84-b00e-095745e17158
[CHAT] üåê Source: web
[CHAT] üë§ User ID: preview-user
[CHAT] üí¨ Conversation ID: cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
======================================================================
[TIMING] Conversation fetch/create: 246ms
[CHAT] Conversation ID: cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
[DEBUG] Starting parallel operations for conversation cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
[DEBUG] About to save message and fetch agent data...
[DEBUG] Agent config fetched: found
[DEBUG] Messages fetched: 12 messages
[DEBUG] Agent fetched: found
[DEBUG] Message saved for cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
[TIMING] Parallel DB operations (save msg + fetch agent/config/messages): 730ms

[MASTER INTENT] ============================================================
[MASTER INTENT] üß† CONTEXT-AWARE INTENT CLASSIFICATION
[MASTER INTENT] ============================================================
[MASTER INTENT] üìù User Message: "Philippe Count, 09248123121..."
[MASTER INTENT] üìä Context Window: 5 messages
[MASTER INTENT] ü§ñ Model: gpt-4.1-nano-2025-04-14 + Pattern Recognition
[MASTER INTENT] üéØ Context: AI just asked about CONTACT
[MASTER INTENT] üîç Pattern Detection: BANT answer detected!
[MASTER INTENT]   Type: contact
[MASTER INTENT]   Confidence: 100%
[MASTER INTENT] ‚úÖ HIGH CONFIDENCE PATTERN MATCH: BANT
[MASTER INTENT] üöÄ Skipping AI classification (pattern confidence: 100%)
[MASTER INTENT] ============================================================

[TIMING] Intent Classification: 0ms 
[CHAT] Intent Classification: BANT

[BANT] ============================================================
[BANT] üéØ PROCESSING BANT WORKFLOW
[BANT] ============================================================
[BANT] üí¨ Conversation ID: cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
[BANT] üë§ User: preview-user
[BANT] üìß Message: "Philippe Count, 09248123121..."
[BANT] Using system_prompt from agent_configs (intent=BANT)
[BANT] Prompt length: 88 characters
[BANT EXTRACTION] Starting synchronous BANT extraction...
[BANT EXTRACTION] Starting with 13 existing messages
[BANT EXTRACTION] Last 3 messages before adding current:
  [0] user: "next month..."
  [1] ai: "Perfect, next month works! Excellent! To send you ..."
  [2] user: "Philippe Count, 09248123121..."
[BANT EXTRACTION] Current message already included, total: 13 messages
[BANT EXTRACTION] Final messages for extraction:
  [9] ai: "Great, for your personal residence! When are you p..."
  [10] user: "next month..."
  [11] ai: "Perfect, next month works! Excellent! To send you ..."
  [12] user: "Philippe Count, 09248123121..."

[EXTRACT BANT] ===== STARTING AI BANT EXTRACTION =====
[EXTRACT BANT] Analyzing last 13 messages
[EXTRACT BANT] ü§ñ Using AI extraction ONLY (no pattern detection)
[EXTRACT BANT] ü§ñ AI Extraction Results:
[EXTRACT BANT]   Budget: 50M
[EXTRACT BANT]   Authority: yes
[EXTRACT BANT]   Need: personal residence
[EXTRACT BANT]   Timeline: next month
[EXTRACT BANT] ‚úÖ Final Results (AI Only):
[EXTRACT BANT]   Budget: 50M
[EXTRACT BANT]   Authority: yes
[EXTRACT BANT]   Need: personal residence
[EXTRACT BANT]   Timeline: next month
[EXTRACT BANT] ===== EXTRACTION COMPLETE =====

[BANT EXTRACTION] Extraction took 1044ms
[BANT PROMPT] Current BANT state after synchronous extraction:
  Budget: 50M
  Authority: yes
  Need: personal residence
  Timeline: next month
[BANT EXTRACTION] BANT fields complete, extracting contact info...
[EXTRACT CONTACT] Result: {
  fullName: 'Philippe Count',
  mobileNumber: '09248123121',
  email: null
}
[BANT EXTRACTION] Contact info extracted: {
  fullName: 'Philippe Count',
  mobileNumber: '09248123121',
  email: null
}
[NORMALIZE BANT] Raw input: {
  budget: '50M',
  authority: 'yes',
  need: 'personal residence',
  timeline: 'next month'
}
[NORMALIZE BANT] Normalized result: {
  authority: 'individual',
  need: 'residence',
  timeline: '1-3m',
  budget_range: 'high'
}

[LEAD] ============================================================
[LEAD] üë• CREATING/UPDATING LEAD
[LEAD] üí¨ Conversation: cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6

[LEAD SCORING] ===== BANT ANALYSIS =====
[LEAD SCORING] üìä Raw BANT Data:
[LEAD SCORING]   Budget: ‚ùå Not provided
[LEAD SCORING]   Authority: individual
[LEAD SCORING]   Need: residence
[LEAD SCORING]   Timeline: 1-3m
[LEAD SCORING] ‚öñÔ∏è Weights: { budget: 30, authority: 20, need: 10, timeline: 30, contact: 10 }
[LEAD SCORING] ü§ñ AI Scoring Prompt Available - Attempting AI-based scoring

[AI SCORING] ===== STARTING AI-BASED BANT SCORING =====
[AI SCORING] Raw BANT: {
  authority: 'individual',
  need: 'residence',
  timeline: '1-3m',
  budget_range: 'high'
}
[AI SCORING] Contact Info: Provided
[AI SCORING] Prompt Length: 1023 characters
[AI SCORING] ü§ñ Calling OpenAI for scoring...
[AI SCORING] ‚è±Ô∏è Response received in 1346ms
[AI SCORING] Raw AI Response: {
  "budget_score": 0,
  "authority_score": 20,
  "need_score": 10,
  "timeline_score": 15,
  "contact_score": 10
}
[AI SCORING] ‚úÖ Parsed Scores: {
  budget_score: 0,
  authority_score: 20,
  need_score: 10,
  timeline_score: 15,
  contact_score: 10
}
[AI SCORING] ===== AI SCORING COMPLETE =====

[LEAD SCORING] ‚úÖ Using AI-generated scores
[LEAD SCORING] üìà Total Lead Score: 55.00
[LEAD SCORING] üìä Individual Scores: {
  budget_score: 0,
  authority_score: 20,
  need_score: 10,
  timeline_score: 15,
  contact_score: 10
}
[LEAD SCORING] üî• Lead Classification: Warm
[LEAD SCORING] üéØ Scoring Method: AI-Based
[LEAD SCORING] ===== ANALYSIS COMPLETE =====

[LEAD] üÜï New Lead CREATED
[LEAD] üÜî Lead ID: eb11f15b-4ad2-44c2-ab50-022306fedccb
[LEAD] üéØ Score: 55
[LEAD] üî• Priority: Warm
[LEAD] ============================================================

[BANT EXTRACTION] Lead updated synchronously
[BANT] Using FIXED QUESTIONS LOGIC for guaranteed accuracy

[EXTRACT BANT] ===== STARTING AI BANT EXTRACTION =====
[EXTRACT BANT] Analyzing last 12 messages
[EXTRACT BANT] ü§ñ Using AI extraction ONLY (no pattern detection)
[EXTRACT BANT] ü§ñ AI Extraction Results:
[EXTRACT BANT]   Budget: 50M
[EXTRACT BANT]   Authority: yes
[EXTRACT BANT]   Need: personal residence
[EXTRACT BANT]   Timeline: next month
[EXTRACT BANT] ‚úÖ Final Results (AI Only):
[EXTRACT BANT]   Budget: 50M
[EXTRACT BANT]   Authority: yes
[EXTRACT BANT]   Need: personal residence
[EXTRACT BANT]   Timeline: next month
[EXTRACT BANT] ===== EXTRACTION COMPLETE =====

[BANT] Previous BANT state: {
  budget: '50M',
  authority: 'yes',
  need: 'personal residence',
  timeline: 'next month'
}
[BANT] üéØ BANT Complete! Creating lead...
[NORMALIZE BANT] Raw input: {
  budget: '50M',
  authority: 'yes',
  need: 'personal residence',
  timeline: 'next month'
}
[NORMALIZE BANT] Normalized result: {
  authority: 'individual',
  need: 'residence',
  timeline: '1-3m',
  budget_range: 'high'
}

[LEAD] ============================================================
[LEAD] üë• CREATING/UPDATING LEAD
[LEAD] üí¨ Conversation: cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6

[LEAD SCORING] ===== BANT ANALYSIS =====
[LEAD SCORING] üìä Raw BANT Data:
[LEAD SCORING]   Budget: 50M
[LEAD SCORING]   Authority: yes
[LEAD SCORING]   Need: personal residence
[LEAD SCORING]   Timeline: next month
[LEAD SCORING] ‚öñÔ∏è Weights: { budget: 30, authority: 20, need: 10, timeline: 30, contact: 10 }
[LEAD SCORING] ü§ñ AI Scoring Prompt Available - Attempting AI-based scoring

[AI SCORING] ===== STARTING AI-BASED BANT SCORING =====
[AI SCORING] Raw BANT: {
  budget: '50M',
  authority: 'yes',
  need: 'personal residence',
  timeline: 'next month'
}
[AI SCORING] Contact Info: Provided
[AI SCORING] Prompt Length: 1023 characters
[AI SCORING] ü§ñ Calling OpenAI for scoring...
[AI SCORING] ‚è±Ô∏è Response received in 866ms
[AI SCORING] Raw AI Response: {
  "budget_score": 25,
  "authority_score": 20,
  "need_score": 10,
  "timeline_score": 25,
  "contact_score": 10
}
[AI SCORING] ‚úÖ Parsed Scores: {
  budget_score: 25,
  authority_score: 20,
  need_score: 10,
  timeline_score: 25,
  contact_score: 10
}
[AI SCORING] ===== AI SCORING COMPLETE =====

[LEAD SCORING] ‚úÖ Using AI-generated scores
[LEAD SCORING] üìà Total Lead Score: 90.00
[LEAD SCORING] üìä Individual Scores: {
  budget_score: 25,
  authority_score: 20,
  need_score: 10,
  timeline_score: 25,
  contact_score: 10
}
[LEAD SCORING] üî• Lead Classification: Hot
[LEAD SCORING] üéØ Scoring Method: AI-Based
[LEAD SCORING] ===== ANALYSIS COMPLETE =====

[LEAD] ‚úÖ Lead UPDATED
[LEAD] üÜî Lead ID: eb11f15b-4ad2-44c2-ab50-022306fedccb
[LEAD] üéØ Score: 90
[LEAD] üî• Priority: Hot
[LEAD] ============================================================

[LEAD] ‚úÖ Lead created successfully: eb11f15b-4ad2-44c2-ab50-022306fedccb
[LEAD] Score: 90
[LEAD] Classification: Hot
[BANT] Fixed response generated:
  Acknowledgment: ""
  Next Question: "Thank you! I have all the information I need. I'll prepare the best property options for you based on your requirements."
  Full Response: "Thank you! I have all the information I need. I'll prepare the best property options for you based on your requirements."

======================================================================
üéâ CHAT REQUEST COMPLETED
======================================================================
[CHAT] üéØ Final Intent: BANT
[CHAT] üí¨ Conversation ID: cb2a2e2d-fcb0-4a08-8be1-b6538dbd4ae6
[CHAT] ü§ñ AI Response: "Thank you! I have all the information I need. I'll prepare the best property options for you based on your requirements...."
[CHAT] ‚è±Ô∏è Total Processing Time: 12979ms
[CHAT] ‚úÖ Response sent to client
======================================================================

[ASYNC] AI message saved
